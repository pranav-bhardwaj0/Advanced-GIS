# -*- coding: utf-8 -*-
"""
Created on Wed Oct  6 22:59:02 2021

@author: pranav bhardwaj

PROCESS FOR EXTRACTING WILDFIRE COUNTS FROM HISTORIC DATABASE
"""
# Import ArcPy, mainly using the management toolbox to sort and clean data. 
import arcpy

# Join wildfire data with the county that it is located in by using the Merge function in the Management Toolbox
# Long code which shows to include specific attributes from both tables
# These attributes are most notably "FireYear" which is used in the next step
arcpy.management.Merge("US_Wildfires_1878_2019;USA_Counties", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb\US_Wildfires_1878_2019_Inter2", 
                       'FireName "FireName" true true false 100 Text 0 0,First,#,US_Wildfires_1878_2019,FireName,0,100;FireCode "FireCode" true true false 50 Text 0 0,First,#,US_Wildfires_1878_2019,FireCode,0,50;FireYear "FireYear" true true false 5 Long 0 5,First,#,US_Wildfires_1878_2019,FireYear,-1,-1;IgntDate "IgntDate" true true false 8 Date 0 0,First,#,US_Wildfires_1878_2019,IgntDate,-1,-1;Acres "Acres" true true false 19 Double 0 0,First,#,US_Wildfires_1878_2019,Acres,-1,-1;Hectares "Hectares" true true false 19 Double 0 0,First,#,US_Wildfires_1878_2019,Hectares,-1,-1;FireCause "FireCause" true true false 100 Text 0 0,First,#,US_Wildfires_1878_2019,FireCause,0,100;Shape_Leng "Shape_Leng" true true false 19 Double 0 0,First,#,US_Wildfires_1878_2019,Shape_Leng,-1,-1,USA_Counties,SHAPE_Leng,-1,-1;Shape_Area "Shape_Area" true true false 19 Double 0 0,First,#,US_Wildfires_1878_2019,Shape_Area,-1,-1,USA_Counties,SHAPE_Area,-1,-1;OBJECTID "OBJECTID" true true false 4 Short 0 4,First,#,USA_Counties,OBJECTID,-1,-1;NAME "NAME" true true false 21 Text 0 0,First,#,USA_Counties,NAME,0,21;STATE_NAME "STATE_NAME" true true false 20 Text 0 0,First,#,USA_Counties,STATE_NAME,0,20;STATE_FIPS "STATE_FIPS" true true false 2 Text 0 0,First,#,USA_Counties,STATE_FIPS,0,2;CNTY_FIPS "CNTY_FIPS" true true false 3 Text 0 0,First,#,USA_Counties,CNTY_FIPS,0,3;FIPS "FIPS" true true false 255 Text 0 0,First,#,USA_Counties,FIPS,0,5', "NO_SOURCE_INFO")

# Separate wildfire into decades to have a sufficient aggregation to analyse
# Use the Select Layer by Attribute function in the Management Toolbox where you specify the the end and start of the decade
# After the SelectLayerByAttribute, the notation goes as follows: 
# Name of the original table merged in the previous step, name of the new table (Start-End of Decade), selection statements to select the FireYear within the decade, "None" for the features not to be included in the new table)
with arcpy.EnvManager(scratchWorkspace=r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb", workspace=r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb"):
   
    arcpy.management.SelectLayerByAttribute("US_Wildfires_1878_2019_Inter", "1878-1879", "FireYear >= 1878 And FireYear <= 1879", None)
    arcpy.management.SelectLayerByAttribute("US_Wildfires_1878_2019_Inter", "1880-1889", "FireYear >= 1880 And FireYear <= 1889", None)
    arcpy.management.SelectLayerByAttribute("US_Wildfires_1878_2019_Inter", "1890-1899", "FireYear >= 1890 And FireYear <= 1899", None)
    arcpy.management.SelectLayerByAttribute("US_Wildfires_1878_2019_Inter", "1900-1909", "FireYear >= 1900 And FireYear <= 1909", None)
    arcpy.management.SelectLayerByAttribute("US_Wildfires_1878_2019_Inter", "1910-1919", "FireYear >= 1910 And FireYear <= 1919", None)
    arcpy.management.SelectLayerByAttribute("US_Wildfires_1878_2019_Inter", "1920-1929", "FireYear >= 1920 And FireYear <= 1929", None)
    arcpy.management.SelectLayerByAttribute("US_Wildfires_1878_2019_Inter", "1930-1939", "FireYear >= 1930 And FireYear <= 1939", None)
    arcpy.management.SelectLayerByAttribute("US_Wildfires_1878_2019_Inter", "1940-1949", "FireYear >= 1940 And FireYear <= 1949", None)
    arcpy.management.SelectLayerByAttribute("US_Wildfires_1878_2019_Inter", "1950-1959", "FireYear >= 1950 And FireYear <= 1959", None)
    arcpy.management.SelectLayerByAttribute("US_Wildfires_1878_2019_Inter", "1960-1969", "FireYear >= 1960 And FireYear <= 1969", None)
    arcpy.management.SelectLayerByAttribute("US_Wildfires_1878_2019_Inter", "1970-1979", "FireYear >= 1970 And FireYear <= 1979", None)
    arcpy.management.SelectLayerByAttribute("US_Wildfires_1878_2019_Inter", "1980-1989", "FireYear >= 1980 And FireYear <= 1989", None)
    arcpy.management.SelectLayerByAttribute("US_Wildfires_1878_2019_Inter", "1990-1999", "FireYear >= 1990 And FireYear <= 1999", None)
    arcpy.management.SelectLayerByAttribute("US_Wildfires_1878_2019_Inter", "2000-2009", "FireYear >= 2000 And FireYear <= 2009", None)
    arcpy.management.SelectLayerByAttribute("US_Wildfires_1878_2019_Inter", "2010-2019", "FireYear >= 2010 And FireYear <= 2019", None)

# Summarize data using Statistics function in the Analysis Toolbox
# Use the decade tables created previous step to get the SUM hectares and SUM acres based on the FIPS code
# Notation in brackets is (Decade Table Name, Workspace and name of newly created Table, Summary Statistics, Frequency count feature (FIPS))
with arcpy.EnvManager(scratchWorkspace=r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb", workspace=r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb"):
    arcpy.analysis.Statistics("1878_1879", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb\c1878_1879_Statistics", "Hectares SUM;Hectares MEAN", "FIPS")
    arcpy.analysis.Statistics("1880_1889", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb\c1880_1889_Statistics", "Hectares SUM;Hectares MEAN", "FIPS")
    arcpy.analysis.Statistics("1890_1899", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb\c1890_1899_Statistics", "Hectares SUM;Hectares MEAN", "FIPS")
    arcpy.analysis.Statistics("1900_1909", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb\c1900_1909_Statistics", "Hectares SUM;Hectares MEAN", "FIPS")
    arcpy.analysis.Statistics("1910_1919", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb\c1910_1919_Statistics", "Hectares SUM;Hectares MEAN", "FIPS")
    arcpy.analysis.Statistics("1920_1929", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb\c1920_1929_Statistics", "Hectares SUM;Hectares MEAN", "FIPS")
    arcpy.analysis.Statistics("1930_1939", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb\c1930_1939_Statistics", "Hectares SUM;Hectares MEAN", "FIPS")
    arcpy.analysis.Statistics("1940_1949", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb\c1940_1949_Statistics", "Hectares SUM;Hectares MEAN", "FIPS")
    arcpy.analysis.Statistics("1950_1959", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb\c1950_1959_Statistics", "Hectares SUM;Hectares MEAN", "FIPS")
    arcpy.analysis.Statistics("1960_1969", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb\c1960_1969_Statistics", "Hectares SUM;Hectares MEAN", "FIPS")
    arcpy.analysis.Statistics("1970_1979", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb\c1970_1979_Statistics", "Hectares SUM;Hectares MEAN", "FIPS")
    arcpy.analysis.Statistics("1980_1989", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb\c1980_1989_Statistics", "Hectares SUM;Hectares MEAN", "FIPS")
    arcpy.analysis.Statistics("1990_1999", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb\c1990_1999_Statistics", "Hectares SUM;Hectares MEAN", "FIPS")
    arcpy.analysis.Statistics("2000_2009", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb\c2000_2009_Statistics", "Hectares SUM;Hectares MEAN", "FIPS")
    arcpy.analysis.Statistics("2010_2019", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb\c2010_2019_Statistics1", "Hectares SUM;Hectares MEAN", "FIPS")
    
# Join the total wildfire count and the decade wildifre count to the USA Counties layer
# Use the AddJoin in the Management toolbox
# Notation in the brackets is (Join Table (USA Counties), Join Features (Indexed FIPS), New Table (Decade), Join Feature (FIPS), Keep All Attributes)
arcpy.management.AddJoin("USA_Counties", "FIPS", "List of FIPS (counties) by total wildfires", "FIPS", "KEEP_ALL")
arcpy.management.AddJoin("USA_Counties", "USA_Counties.FIPS", "1878-1879", "FIPS", "KEEP_ALL")
arcpy.management.AddJoin("USA_Counties", "USA_Counties.FIPS", "1880-1889", "FIPS", "KEEP_ALL")
arcpy.management.AddJoin("USA_Counties", "USA_Counties.FIPS", "1890-1899", "FIPS", "KEEP_ALL")
arcpy.management.AddJoin("USA_Counties", "USA_Counties.FIPS", "1900-1909", "FIPS", "KEEP_ALL")
arcpy.management.AddJoin("USA_Counties", "USA_Counties.FIPS", "1910-1919", "FIPS", "KEEP_ALL")
arcpy.management.AddJoin("USA_Counties", "USA_Counties.FIPS", "1920-1929", "FIPS", "KEEP_ALL")
arcpy.management.AddJoin("USA_Counties", "USA_Counties.FIPS", "1930-1939", "FIPS", "KEEP_ALL")
arcpy.management.AddJoin("USA_Counties", "USA_Counties.FIPS", "1940-1949", "FIPS", "KEEP_ALL")
arcpy.management.AddJoin("USA_Counties", "USA_Counties.FIPS", "1950-1959", "FIPS", "KEEP_ALL")
arcpy.management.AddJoin("USA_Counties", "USA_Counties.FIPS", "1960-1969", "FIPS", "KEEP_ALL")
arcpy.management.AddJoin("USA_Counties", "USA_Counties.FIPS", "1970-1979", "FIPS", "KEEP_ALL")
arcpy.management.AddJoin("USA_Counties", "USA_Counties.FIPS", "1980-1989", "FIPS", "KEEP_ALL")
arcpy.management.AddJoin("USA_Counties", "USA_Counties.FIPS", "1990-1999", "FIPS", "KEEP_ALL")
arcpy.management.AddJoin("USA_Counties", "USA_Counties.FIPS", "2000-2009", "FIPS", "KEEP_ALL")
arcpy.management.AddJoin("USA_Counties", "USA_Counties.FIPS", "2010-2019", "FIPS", "KEEP_ALL")

# Clean and export the data using the TableToTable function in the conversion toolbox
# Select just the name of the county, FIPS code, and frequency/sums for each decade
arcpy.conversion.TableToTable("USA_Counties", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\PythonProject.gdb", "Wildfires_County", '', 'FID_1 "FID_1" true true false 4 Short 0 4,First,#,USA_Counties,USA_Counties.FID_1,-1,-1;COUNTY_NAME "COUNTY_NAME" true true false 21 Text 0 0,First,#,USA_Counties,USA_Counties.NAME,0,21;STATE_NAME "STATE_NAME" true true false 20 Text 0 0,First,#,USA_Counties,USA_Counties.STATE_NAME,0,20;FIPS "FIPS" true true false 5 Text 0 0,First,#,USA_Counties,USA_Counties.FIPS,0,5;SQMI "SQMI" true true false 24 Double 15 23,First,#,USA_Counties,USA_Counties.SQMI,-1,-1;TOTAL_WILDFIRES "TOTAL_WILDFIRES" true true false 4 Long 0 0,First,#,USA_Counties,US_Wildfires_1878_2019_Inter5.FREQUENCY,-1,-1;1878_1879_COUNT "1878_1879_COUNT" true true false 4 Long 0 0,First,#,USA_Counties,c1878_1879_Statistics.FREQUENCY,-1,-1;1878_1879_Hectares_Sum "1878_1879_Hectares_Sum" true true false 8 Double 0 0,First,#,USA_Counties,c1878_1879_Statistics.SUM_Hectares,-1,-1;1878_1879_Hectares_Mean "1878_1879_Hectares_Mean" true true false 8 Double 0 0,First,#,USA_Counties,c1878_1879_Statistics.MEAN_Hectares,-1,-1;1880_1889_COUNT "1880_1889_COUNT" true true false 4 Long 0 0,First,#,USA_Counties,c1880_1889_Statistics.FREQUENCY,-1,-1;1880_1889_Hectares_Sum "1880_1889_Hectares_Sum" true true false 8 Double 0 0,First,#,USA_Counties,c1880_1889_Statistics.SUM_Hectares,-1,-1;1880_1889_Hectares_Mean "1880_1889_Hectares_Mean" true true false 8 Double 0 0,First,#,USA_Counties,c1880_1889_Statistics.MEAN_Hectares,-1,-1;1890_1899_COUNT "1890_1899_COUNT" true true false 4 Long 0 0,First,#,USA_Counties,c1890_1899_Statistics1.FREQUENCY,-1,-1;1890_1899_Hectares_Sum "1890_1899_Hectares_Sum" true true false 8 Double 0 0,First,#,USA_Counties,c1890_1899_Statistics1.SUM_Hectares,-1,-1;1890_1899_Hectares_Mean "1890_1899_Hectares_Mean" true true false 8 Double 0 0,First,#,USA_Counties,c1890_1899_Statistics1.MEAN_Hectares,-1,-1;1900_1909_COUNT "1900_1909_COUNT" true true false 4 Long 0 0,First,#,USA_Counties,c1900_1909_Statistics_Statis.FREQUENCY,-1,-1;1900_1909_Hectares_Sum "1900_1909_Hectares_Sum" true true false 8 Double 0 0,First,#,USA_Counties,c1900_1909_Statistics_Statis.SUM_Hectares,-1,-1;1900_1909_Hectares_Mean "1900_1909_Hectares_Mean" true true false 8 Double 0 0,First,#,USA_Counties,c1900_1909_Statistics_Statis.MEAN_Hectares,-1,-1;1910_1919_COUNT "1910_1919_COUNT" true true false 4 Long 0 0,First,#,USA_Counties,c1910_1919_Statistics2.FREQUENCY,-1,-1;1910_1919_Hectares_Sum "1910_1919_Hectares_Sum" true true false 8 Double 0 0,First,#,USA_Counties,c1910_1919_Statistics2.SUM_Hectares,-1,-1;1910_1919_Hectares_Mean "1910_1919_Hectares_Mean" true true false 8 Double 0 0,First,#,USA_Counties,c1910_1919_Statistics2.MEAN_Hectares,-1,-1;1920_1929_COUNT "1920_1929_COUNT" true true false 4 Long 0 0,First,#,USA_Counties,c1920_1929_Statistics1.FREQUENCY,-1,-1;1920_1929_Hectares_Sum "1920_1929_Hectares_Sum" true true false 8 Double 0 0,First,#,USA_Counties,c1920_1929_Statistics1.SUM_Hectares,-1,-1;1920_1929_Hectares_Mean "1920_1929_Hectares_Mean" true true false 8 Double 0 0,First,#,USA_Counties,c1920_1929_Statistics1.MEAN_Hectares,-1,-1;1930_1939_COUNT "1930_1939_COUNT" true true false 4 Long 0 0,First,#,USA_Counties,c1930_1939_Statistics1.FREQUENCY,-1,-1;1930_1939_Hectares_Sum "1930_1939_Hectares_Sum" true true false 8 Double 0 0,First,#,USA_Counties,c1930_1939_Statistics1.SUM_Hectares,-1,-1;1930_1939_Hectares_Mean "1930_1939_Hectares_Mean" true true false 8 Double 0 0,First,#,USA_Counties,c1930_1939_Statistics1.MEAN_Hectares,-1,-1;1940_1949_COUNT "1940_1949_COUNT" true true false 4 Long 0 0,First,#,USA_Counties,c1940_1949_Statistics1.FREQUENCY,-1,-1;1940_1949_Hectares_Sum "1940_1949_Hectares_Sum" true true false 8 Double 0 0,First,#,USA_Counties,c1940_1949_Statistics1.SUM_Hectares,-1,-1;1940_1949_Hectares_Mean "1940_1949_Hectares_Mean" true true false 8 Double 0 0,First,#,USA_Counties,c1940_1949_Statistics1.MEAN_Hectares,-1,-1;1950_1959_COUNT "1950_1959_COUNT" true true false 4 Long 0 0,First,#,USA_Counties,c1950_1959_Statistics1.FREQUENCY,-1,-1;1950_1959_Hectares_Sum "1950_1959_Hectares_Sum" true true false 8 Double 0 0,First,#,USA_Counties,c1950_1959_Statistics1.SUM_Hectares,-1,-1;1950_1959_Hectares_Mean "1950_1959_Hectares_Mean" true true false 8 Double 0 0,First,#,USA_Counties,c1950_1959_Statistics1.MEAN_Hectares,-1,-1;1960_1969_COUNT "1960_1969_COUNT" true true false 4 Long 0 0,First,#,USA_Counties,c1960_1969_Statistics1.FREQUENCY,-1,-1;1960_1969_Hectares_Sum "1960_1969_Hectares_Sum" true true false 8 Double 0 0,First,#,USA_Counties,c1960_1969_Statistics1.SUM_Hectares,-1,-1;1960_1969_Hectares_Sum "1960_1969_Hectares_Sum" true true false 8 Double 0 0,First,#,USA_Counties,c1960_1969_Statistics1.MEAN_Hectares,-1,-1;1970_1979_COUNT "1970_1979_COUNT" true true false 4 Long 0 0,First,#,USA_Counties,c1970_1979_Statistics1.FREQUENCY,-1,-1;1970_1979_Hectares_Sum "1970_1979_Hectares_Sum" true true false 8 Double 0 0,First,#,USA_Counties,c1970_1979_Statistics1.SUM_Hectares,-1,-1;1970_1979_Hectares_Mean "1970_1979_Hectares_Mean" true true false 8 Double 0 0,First,#,USA_Counties,c1970_1979_Statistics1.MEAN_Hectares,-1,-1;1980_1989_COUNT "1980_1989_COUNT" true true false 4 Long 0 0,First,#,USA_Counties,c1980_1989_Statistics1.FREQUENCY,-1,-1;1980_1989_Hectares_Sum "1980_1989_Hectares_Sum" true true false 8 Double 0 0,First,#,USA_Counties,c1980_1989_Statistics1.SUM_Hectares,-1,-1;1980_1989_Hectares_Mean "1980_1989_Hectares_Mean" true true false 8 Double 0 0,First,#,USA_Counties,c1980_1989_Statistics1.MEAN_Hectares,-1,-1;1990_1999_COUNT "1990_1999_COUNT" true true false 4 Long 0 0,First,#,USA_Counties,c1990_1999_Statistics1.FREQUENCY,-1,-1;1990_1999_Hectares_Sum "1990_1999_Hectares_Sum" true true false 8 Double 0 0,First,#,USA_Counties,c1990_1999_Statistics1.SUM_Hectares,-1,-1;1990_1999_Hectares_Mean "1990_1999_Hectares_Mean" true true false 8 Double 0 0,First,#,USA_Counties,c1990_1999_Statistics1.MEAN_Hectares,-1,-1;2000_2009_COUNT "2000_2009_COUNT" true true false 4 Long 0 0,First,#,USA_Counties,c2000_2009_Statistics1.FREQUENCY,-1,-1;2000_2009_Hectares_Sum "2000_2009_Hectares_Sum" true true false 8 Double 0 0,First,#,USA_Counties,c2000_2009_Statistics1.SUM_Hectares,-1,-1;2000_2009_Hectares_Mean "2000_2009_Hectares_Mean" true true false 8 Double 0 0,First,#,USA_Counties,c2000_2009_Statistics1.MEAN_Hectares,-1,-1;2010_2019_COUNT "2010_2019_COUNT" true true false 4 Long 0 0,First,#,USA_Counties,c2010_2019_Statistics1.FREQUENCY,-1,-1;2010_2019_Hectares_Sum "2010_2019_Hectares_Sum" true true false 8 Double 0 0,First,#,USA_Counties,c2010_2019_Statistics1.SUM_Hectares,-1,-1;2010_2019_Hectares_Mean "2010_2019_Hectares_Mean" true true false 8 Double 0 0,First,#,USA_Counties,c2010_2019_Statistics1.MEAN_Hectares,-1,-1', '')

# Convert and export by using the TableToExcel function in the conversion toolbox. 
arcpy.conversion.TableToExcel("Wildfires_County", r"C:\Users\prana\OneDrive\Documents\ArcGIS\Projects\PythonProject\Wildfires_County_TableToExcel.xlsx", "NAME", "CODE")